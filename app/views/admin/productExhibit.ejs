<%- include('../partials/admin/adminHeader.ejs'); %>
<link rel="stylesheet" href="/css/common/button.css">
<link rel="stylesheet" href="/css/admin/productExhibit.css">
<main>
  <h2>出品管理</h2>
  <h3>オークションid,在庫(車)id検索 オークション終了してる(入札権付与) or してない(入札履歴確認 + 更新、削除)</h3>
  <a href="/admin/product/prepare/1"><button>出品前商品一覧</button></a>
  <a href="/admin/product/exhibit/1?query=schedule"><button>出品予定一覧</button></a>
  <a href="/admin/product/exhibit/1?query=open"><button>出品中商品一覧</button></a>
  <a href="/admin/product/exhibit/1?query=close"><button>出品期間終了一覧</button></a>

  <!-- 現在出品中一覧 時間軸で並び替え？ + 出品状態で並び替え + 更新をmodal?  -->
  <table class="uk-table uk-table-divider">
    <thead>
      <tr>
        <th>商品ID</th>
        <th>開始金額</th>
        <th>希望金額</th>
        <th>開始時間</th>
        <th>終了時間</th>
        <th>車画像</th>
        <th>車の名前</th>
        <th>メーカー</th>
        <th>車の状態</th>
        <th>入荷価格</th>
      </tr>
    </thead>
    <tbody> <% for (var i = 0; i < ejsRender.sql.length; i++) { %> <tr>
        <td><%- ejsRender.sql[i].product_id %></td>
        <td><%- ejsRender.sql[i].start_price %></td>
        <td><%- ejsRender.sql[i].asking_price %></td>
        <td><%- ejsRender.sql[i].start_time %></td>
        <td><%- ejsRender.sql[i].end_time %></td>
        <td><%- ejsRender.sql[i].car_img %></td>
        <td><%- ejsRender.sql[i].car_name%></td>
        <td><%- ejsRender.sql[i].maker_name%></td>
        <td><%- ejsRender.sql[i].car_state %></td>
        <td><%- ejsRender.sql[i].arrival_price %></td>
        <td>
          <a href="#modal-center<%= i %>" uk-toggle>
            <button class="uk-button uk-button-default alinkButtonSize">更新する</button></a>
        </td>
        <td>
          <a href="/admin/product/delete/<%- ejsRender.sql[i].product_id %>">
            <button class="uk-button uk-button-default alinkButtonSize">削除する</button></a>
        </td>
      </tr>
      <div id="modal-center<%= i %>" class="uk-flex-top" uk-modal>
        <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
          <button class="uk-modal-close-default" type="button" uk-close></button>
          <h4>入力してください</h4>
          <form method="post" action="/admin/product/update">
            <label for="product_id">商品ID <span><%- ejsRender.sql[i].product_id %></span></label>
            <input type="hidden" name="product_id" id="product_id" value="<%- ejsRender.sql[i].product_id %>">
            <label for="start_price">開始金額</label>
            <input type="number" step="100" name="start_price" id="start_price"
              value="<%- ejsRender.sql[i].start_price %>" required>
            <label for="asking_price">希望金額</label>
            <input type="number" step="100" id="asking_price" name="asking_price"
              value="<%- ejsRender.sql[i].asking_price %>" required>
            <label for="start_time">開始時間</label>
            <input type="date" id="start_time" name="start_time" value="<%- ejsRender.sql[i].start_time %>" required>
            <label for="end_time">終了時間</label>
            <input type="date" id="end_time" name="end_time" value="<%- ejsRender.sql[i].end_time %>" required>
            <label for="car_img">車画像 <span><%- ejsRender.sql[i].car_img %></span></label>
            <input type="file" id="car_img" name="car_img" value="<%- ejsRender.sql[i].car_img %>">
            <button type="submit">更新する</button>
          </form>
        </div>
      </div> <% } %>
    </tbody>
  </table>
  <ul class="uk-pagination uk-flex-between">
    <li class="<%_ if(ejsRender.params.pageId <= 1) { _%> uk-disabled <% } %>"><a
        href="/admin/product/exhibit/<%- ejsRender.params.pageId - 1 %>"><span class="uk-margin-small-right"
          uk-pagination-previous></span>Previous</a></li>
    <div class="uk-pagination"> <% for(let i = 1; i <= ejsRender.sql2; i++) { %> <li><a
          href="/admin/product/exhibit/<%= i %>"><%= i %></a></li>
      <!-- <li class="uk-disabled"><span>…</span></li> --> <% } %> </div>
    <li class="<%_ if(ejsRender.params.pageId >= ejsRender.sql2) { _%> uk-disabled <% } %>"><a
        href="/admin/product/exhibit/<%- ejsRender.params.pageId+1  %>">Next<span class="uk-margin-small-left"
          uk-pagination-next></span></a>
    </li>
  </ul>
</main>
<script>
  const info = JSON.parse('<%- JSON.stringify(ejsRender) %>');
  console.log(info);
</script> <%- include('../partials/admin/adminFooter.ejs'); %>
